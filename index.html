<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Realfoodaholic - Recetas de comida real</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head>
<body>
    <header>
        <div class="header-content">
            <a href="index.html" class="logo">
                <img src="img/avatar.jpg" alt="Realfoodaholic">
                <div class="logo-text">
                    <span>realfoodaholic</span>
                    <nav>
                        <a href="index.html">Inicio</a>
                        <a href="categorias.html">Categor√≠as</a>
                        <a href="contacto.html">Contacto</a>
                    </nav>
                </div>
            </a>
        </div>
    </header>
    
    <section class="hero">
        <div class="container">
            <h1>Recetas de comida real</h1>
            <p>Bienvenid@ a Realfoodaholic, tu portal de recetas saludables, sencillas y ricas hechas con comida real.</p>
        </div>
    </section>
    
    <section class="search-section">
        <div class="search-box">
            <input type="text" id="search-input" placeholder="Buscar recetas o ingredientes..." onkeyup="filterRecipes()">
            <button onclick="filterRecipes()">Buscar</button>
        </div>
        <div class="category-filters">
            <button class="filter-btn active" data-category="all" onclick="filterByCategory('all')">Todas</button>
            <button class="filter-btn" data-category="acompanamientos" onclick="filterByCategory('acompanamientos')">Acompa√±amientos</button>
            <button class="filter-btn" data-category="desayunos-2" onclick="filterByCategory('desayunos-2')">Desayunos</button>
            <button class="filter-btn" data-category="ensaladas" onclick="filterByCategory('ensaladas')">Ensaladas</button>
            <button class="filter-btn" data-category="microondas" onclick="filterByCategory('microondas')">Microondas</button>
            <button class="filter-btn" data-category="olla-lenta" onclick="filterByCategory('olla-lenta')">Olla lenta</button>
            <button class="filter-btn" data-category="platos-principales" onclick="filterByCategory('platos-principales')">Platos principales</button>
            <button class="filter-btn" data-category="postres" onclick="filterByCategory('postres')">Postres</button>
            <button class="filter-btn" data-category="salsas" onclick="filterByCategory('salsas')">Salsas</button>
            <button class="filter-btn" data-category="snacks-2" onclick="filterByCategory('snacks-2')">Snacks dulces</button>
            <button class="filter-btn" data-category="snacks" onclick="filterByCategory('snacks')">Snacks salados</button>
            <button class="filter-btn" data-category="sopas-y-cremas" onclick="filterByCategory('sopas-y-cremas')">Sopas y cremas</button>
            <button class="filter-btn" data-category="recetas-veganas" onclick="filterByCategory('recetas-veganas')">Veganas</button>
			<button class="filter-btn" data-category="alimentacion-saludable" onclick="filterByCategory('alimentacion-saludable')">Alimentaci√≥n saludable</button>
			<button class="filter-btn" data-category="comercio-local" onclick="filterByCategory('comercio-local')">Comercio local</button>
			<button class="filter-btn" data-category="videos" onclick="filterByCategory('videos')">V√≠deos</button>
        </div>
        <div class="sort-options">
            <span>Ordenar:</span>
            <button class="sort-btn active" data-sort="alpha" onclick="setSortOrder('alpha')">A-Z</button>
            <button class="sort-btn" data-sort="recent" onclick="setSortOrder('recent')">Recientes</button>
        </div>
    </section>
    
    <main class="container recipes-section">
        <div class="recipes-grid" id="recipes-grid">
            <p style="text-align: center; padding: 40px;">Cargando recetas...</p>
        </div>
        <div class="no-results hidden" id="no-results">
            <h3>No se encontraron recetas</h3>
            <p>Prueba con otros t√©rminos de b√∫squeda o categor√≠a</p>
        </div>
    </main>
    
    <footer>
        <div class="container">
            <p>Realfoodaholic - Recetas de comida real ü•ó</p>
        </div>
    </footer>
    
    <script>
    // Mapeo de slugs a nombres de categor√≠as
    const categoriasNombres = {
        "platos-principales": "Platos principales",
        "ensaladas": "Ensaladas",
        "desayunos-2": "Desayunos",
        "postres": "Postres",
        "recetas-veganas": "Veganas",
        "snacks-2": "Snacks dulces",
        "snacks": "Snacks salados",
        "sopas-y-cremas": "Sopas y cremas",
        "salsas": "Salsas y pat√©s",
        "acompanamientos": "Acompa√±amientos",
        "olla-lenta": "Olla lenta",
        "microondas": "Microondas"
    };

    let recipes = [];
    let currentCategory = 'all';
    let currentSearch = '';
    let currentSort = 'alpha';
    
    function renderRecipes(recipesToShow) {
        const grid = document.getElementById('recipes-grid');
        const noResults = document.getElementById('no-results');
        
        if (recipesToShow.length === 0) {
            grid.innerHTML = '';
            noResults.classList.remove('hidden');
            return;
        }
        
        noResults.classList.add('hidden');
        grid.innerHTML = recipesToShow.map(recipe => {
            const imgHtml = recipe.thumbnail ? `<img src="${recipe.thumbnail}" alt="${recipe.title}" loading="lazy">` : '';
            // Usar el mapeo para obtener nombre de categor√≠a
            const catSlug = recipe.categories ? recipe.categories[0] : '';
            const catName = categoriasNombres[catSlug] || catSlug;
            return `<article class="recipe-card">
                <a href="recetas/${recipe.slug}.html">
                    <div class="recipe-card-img">${imgHtml}</div>
                    <div class="recipe-card-body">
                        <h3>${recipe.title}</h3>
                        <div class="recipe-card-meta">
                            <span>${recipe.date}</span>
                            <span class="recipe-card-category">${catName}</span>
                        </div>
                    </div>
                </a>
            </article>`;
        }).join('');
    }
    
    function filterRecipes() {
        currentSearch = document.getElementById('search-input').value.toLowerCase().trim();
        applyFilters();
    }
    
    function filterByCategory(category) {
        currentCategory = category;
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.category === category) btn.classList.add('active');
        });
        applyFilters();
    }
    
    function setSortOrder(order) {
        currentSort = order;
        document.querySelectorAll('.sort-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.sort === order) btn.classList.add('active');
        });
        applyFilters();
    }
    
    function applyFilters() {
        let filtered = recipes;
        
        // Filtrar por categor√≠a
        if (currentCategory !== 'all') {
            filtered = filtered.filter(r => r.categories && r.categories.includes(currentCategory));
        }
        
        // Filtrar por b√∫squeda (t√≠tulo, categor√≠as e ingredientes)
        if (currentSearch) {
            filtered = filtered.filter(r => {
                // Buscar en t√≠tulo
                const titleMatch = r.title && r.title.toLowerCase().includes(currentSearch);
                
                // Buscar en categor√≠as
                const catMatch = r.categories && r.categories.some(cat => {
                    const catName = categoriasNombres[cat] || cat;
                    return catName.toLowerCase().includes(currentSearch);
                });
                
                // Buscar en ingredientes
                const ingMatch = r.ingredientes && r.ingredientes.toLowerCase().includes(currentSearch);
                
                // Buscar en excerpt/descripci√≥n
                const excerptMatch = r.excerpt && r.excerpt.toLowerCase().includes(currentSearch);
                
                return titleMatch || catMatch || ingMatch || excerptMatch;
            });
        }
        
        // Ordenar seg√∫n selecci√≥n
        if (currentSort === 'alpha') {
            filtered = [...filtered].sort((a, b) => a.title.localeCompare(b.title, 'es'));
        } else {
            filtered = [...filtered].sort((a, b) => new Date(b.date) - new Date(a.date));
        }
        
        renderRecipes(filtered);
    }
    
    // Leer hash de la URL para activar filtro de categor√≠a
    function checkUrlHash() {
        const hash = window.location.hash.substring(1);
        if (hash) {
            const btn = document.querySelector(`.filter-btn[data-category="${hash}"]`);
            if (btn) {
                filterByCategory(hash);
                document.querySelector('.recipes-section').scrollIntoView({ behavior: 'smooth' });
                return true;
            }
        }
        return false;
    }
    
    // Cargar todas las recetas desde el JSON
    async function loadAllRecipes() {
        try {
            const response = await fetch('/recetas-nuevas.json');
            if (!response.ok) throw new Error('No se pudo cargar el JSON');
            
            recipes = (await response.json()).filter(r => r.title && r.slug);
            
            // Asegurar que no hay duplicados por slug
            const seen = new Set();
            recipes = recipes.filter(r => {
                if (seen.has(r.slug)) return false;
                seen.add(r.slug);
                return true;
            });
            
            if (!checkUrlHash()) {
                applyFilters();
            }
        } catch (e) {
            console.error('Error cargando recetas:', e);
            document.getElementById('recipes-grid').innerHTML = 
                '<p style="text-align: center; color: red;">Error cargando las recetas. Por favor, recarga la p√°gina.</p>';
        }
    }
    
    loadAllRecipes();
    
    // Escuchar cambios de hash
    window.addEventListener('hashchange', checkUrlHash);
    </script>
    
    <script>
    if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
            if (!user) {
                window.netlifyIdentity.on("login", () => {
                    document.location.href = "/admin/";
                });
            }
        });
    }
    </script>
</body>
</html>
